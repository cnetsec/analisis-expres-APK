name: ğŸ” AnÃ¡lisis APK Express (Preciso)

on: workflow_dispatch: inputs: apk_file: description: 'ğŸ—‚ï¸ Nombre del APK (ej: app.apk)' required: true default: 'app.apk' type: string

jobs: apk_analysis: runs-on: ubuntu-latest name: ğŸ” AnÃ¡lisis APK (ApkTool + Findings)

steps:
  - name: ğŸ“¥ Clonar repositorio
    uses: actions/checkout@v4

  - name: âš™ï¸ Instalar herramientas necesarias
    run: |
      sudo apt-get update
      sudo apt-get install -y apktool jq curl unzip default-jdk grep

  - name: ğŸ§‰ DECOMPILACIÃ“N APKTOOL
    run: |
      mkdir -p decompilado
      apktool d "${{ inputs.apk_file }}" -o decompilado -f || echo "âš ï¸ Error al decompilar APK"
      find decompilado/ -type f î€-name '*.png' -o -name '*.jpg' -o -name '*.ttf' -o -name '*.so'î€ -delete

  - name: ğŸ” PERMISOS PELIGROSOS
    run: |
      echo "ğŸ” Permisos peligrosos:" > resumen_apk.txt
      grep -oP 'android\.permission\.[A-Z_]+' decompilado/AndroidManifest.xml | sort -u >> resumen_apk.txt || echo "âœ”ï¸ Sin permisos detectados" >> resumen_apk.txt

  - name: ğŸŒ URLS EXPUESTAS
    run: |
      echo -e "\nğŸŒ URLs encontradas:" >> resumen_apk.txt
      grep -rEo 'https?://[a-zA-Z0-9./?=_-]+' decompilado/ | grep -vE '\\.(png|jpg|jpeg|svg|woff|ttf)' | sort -u >> resumen_apk.txt || echo "âœ”ï¸ No se encontraron URLs" >> resumen_apk.txt

  - name: âš ï¸ FLAGS DE SEGURIDAD
    run: |
      echo -e "\nâš ï¸ Flags de seguridad:" >> resumen_apk.txt
      grep -i 'android:debuggable="true"' decompilado/AndroidManifest.xml >> resumen_apk.txt || echo "âœ”ï¸ debuggable no habilitado" >> resumen_apk.txt
      grep -i 'android:allowBackup="true"' decompilado/AndroidManifest.xml >> resumen_apk.txt || echo "âœ”ï¸ allowBackup no habilitado" >> resumen_apk.txt
      grep -i 'android:usesCleartextTraffic="true"' decompilado/AndroidManifest.xml >> resumen_apk.txt || echo "âœ”ï¸ usesCleartextTraffic no habilitado" >> resumen_apk.txt

  - name: ğŸª§ STRINGS SENSIBLES (Refinado)
    run: |
      echo -e "\nğŸª§ Posibles secretos expuestos:" >> resumen_apk.txt
      grep -I -rE '(?i)(apikey|token|secret|auth|pass|key)[\s:=]{0,3}["\'']?[A-Za-z0-9\-_\.@]{10,}' decompilado/ | grep -vE '\\.(png|jpg|jpeg|ttf|so)' | sort -u | head -n 20 >> resumen_apk.txt || echo "âœ”ï¸ No se detectaron secretos" >> resumen_apk.txt

  - name: ğŸ” CERTIFICADO APK
    run: |
      echo -e "\nğŸ” Certificado del APK:" >> resumen_apk.txt
      keytool -printcert -jarfile "${{ inputs.apk_file }}" >> resumen_apk.txt || echo "âš ï¸ No se pudo leer el certificado" >> resumen_apk.txt

  - name: ğŸ“ƒ Mostrar resumen en pantalla (muestras)
    run: |
      echo "\nğŸ”¹ Fragmento del resumen:"
      head -n 40 resumen_apk.txt

  - name: ğŸ“‚ Subir resumen como artefacto
    uses: actions/upload-artifact@v4
    with:
      name: resumen_apk
      path: resumen_apk.txt


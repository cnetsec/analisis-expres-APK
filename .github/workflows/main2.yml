name: ğŸ“± AnÃ¡lisis APK ExprÃ©s

on:
  workflow_dispatch:
    inputs:
      apk_name:
        description: 'ğŸ—‚ï¸ Nombre del archivo APK (ej: app.apk)'
        required: true
        default: 'app.apk'
        type: string

jobs:
  analisis_apk:
    name: ğŸ” AnÃ¡lisis ExprÃ©s del APK
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Clonar repositorio
        uses: actions/checkout@v4

      - name: âš™ï¸ Instalar dependencias necesarias
        run: |
          sudo apt-get update -y
          sudo apt-get install -y apktool wget unzip grep

      - name: ğŸ“¦ Preparar entorno
        run: mkdir -p decompilado

      - name: ğŸ› ï¸ Decompilar APK
        run: |
          apktool d "${{ inputs.apk_name }}" -o decompilado -f

      - name: ğŸ§ª Iniciar resumen de anÃ¡lisis
        run: |
          echo "ğŸ“„ Resumen del anÃ¡lisis de '${{ inputs.apk_name }}'" > resumen_apk.txt

      - name: ğŸ” Permisos peligrosos
        run: |
          echo -e "\nğŸ” Permisos peligrosos:" >> resumen_apk.txt
          grep -i "uses-permission" decompilado/AndroidManifest.xml | grep -Ei "INTERNET|SMS|READ_CONTACTS|CAMERA" >> resumen_apk.txt || echo "âœ”ï¸ No se detectaron permisos crÃ­ticos" >> resumen_apk.txt

      - name: ğŸŒ URLs encontradas
        run: |
          echo -e "\nğŸŒ URLs encontradas:" >> resumen_apk.txt
          grep -IorE 'https?://[a-zA-Z0-9./?=_\-]+' decompilado/ | sort -u >> resumen_apk.txt || echo "âœ”ï¸ No se encontraron URLs" >> resumen_apk.txt

      - name: âš ï¸ Flags de seguridad
        run: |
          echo -e "\nâš ï¸ Flags de seguridad:" >> resumen_apk.txt
          grep -iE "android:debuggable|allowBackup" decompilado/AndroidManifest.xml >> resumen_apk.txt || echo "âœ”ï¸ No se encontraron flags inseguras" >> resumen_apk.txt

      - name: ğŸ§ª Posibles secretos expuestos
        run: |
          echo -e "\nğŸ§ª Posibles secretos expuestos:" >> resumen_apk.txt
          grep -IorE "(apikey|secret|token|password|bearer|auth|authorization|client_id|jwt)[\"'=:\s]+[a-zA-Z0-9_\-]{8,}" decompilado/ | sort -u >> resumen_apk.txt || echo "âœ”ï¸ No se detectaron secretos" >> resumen_apk.txt

      - name: ğŸ“„ Mostrar resumen en pantalla
        run: |
          echo -e "\nğŸ“‹ RESUMEN:"
          cat resumen_apk.txt

      - name: ğŸ’¾ Subir artefacto de resultados
        uses: actions/upload-artifact@v4
        with:
          name: resumen-apk
          path: resumen_apk.txt
